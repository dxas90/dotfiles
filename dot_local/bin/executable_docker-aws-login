#!/usr/bin/env bash
set -euo pipefail

REGION="${1:-us-east-1}"

echo "Logging into AWS ECR in region: $REGION..."

ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text 2>/dev/null || true)

if [[ -z "$ACCOUNT_ID" ]]; then
  echo "❌ Failed to get AWS account ID. Are your AWS credentials configured?"
  exit 1
fi

REGISTRY="${ACCOUNT_ID}.dkr.ecr.${REGION}.amazonaws.com"

aws ecr get-login-password --region "$REGION" \
  | docker login \
      --username AWS \
      --password-stdin "$REGISTRY"

echo "✅ Logged into $REGISTRY"

